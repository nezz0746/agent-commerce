{"version":3,"sources":["../src/index.ts","../src/tools/read.ts","../src/types.ts","../src/subgraph.ts","../src/tools/write.ts","../src/abis/Shop.ts","../src/client.ts","../src/tools/admin.ts","../src/abis/CommerceHub.ts"],"sourcesContent":["import { McpServer } from \"@modelcontextprotocol/sdk/server/mcp.js\";\nimport { StdioServerTransport } from \"@modelcontextprotocol/sdk/server/stdio.js\";\nimport { registerReadTools } from \"./tools/read.js\";\nimport { registerWriteTools } from \"./tools/write.js\";\nimport { registerAdminTools } from \"./tools/admin.js\";\n\nconst server = new McpServer({\n  name: \"onchain-commerce\",\n  version: \"0.1.0\",\n});\n\n// Register all tools\nregisterReadTools(server);\nregisterWriteTools(server);\nregisterAdminTools(server);\n\n// Start the server with stdio transport\nconst transport = new StdioServerTransport();\nawait server.connect(transport);\n","import { McpServer } from \"@modelcontextprotocol/sdk/server/mcp.js\";\nimport { z } from \"zod\";\nimport * as subgraph from \"../subgraph.js\";\n\nexport function registerReadTools(server: McpServer) {\n  server.tool(\n    \"list_shops\",\n    \"List all shops on the Onchain Commerce protocol\",\n    {},\n    async () => {\n      const data = await subgraph.listShops();\n      return { content: [{ type: \"text\", text: JSON.stringify(data, null, 2) }] };\n    }\n  );\n\n  server.tool(\n    \"get_shop\",\n    \"Get detailed shop info including products, categories, collections, orders, and reviews\",\n    { shopAddress: z.string().describe(\"Shop contract address\") },\n    async ({ shopAddress }) => {\n      const data = await subgraph.getShop(shopAddress);\n      return { content: [{ type: \"text\", text: JSON.stringify(data, null, 2) }] };\n    }\n  );\n\n  server.tool(\n    \"get_product\",\n    \"Get product details with variants\",\n    {\n      shopAddress: z.string().describe(\"Shop contract address\"),\n      productId: z.string().describe(\"Product ID\"),\n    },\n    async ({ shopAddress, productId }) => {\n      const data = await subgraph.getProduct(shopAddress, productId);\n      return { content: [{ type: \"text\", text: JSON.stringify(data, null, 2) }] };\n    }\n  );\n\n  server.tool(\n    \"get_orders\",\n    \"Get all orders for a customer address\",\n    { customerAddress: z.string().describe(\"Customer wallet address\") },\n    async ({ customerAddress }) => {\n      const data = await subgraph.getOrders(customerAddress);\n      return { content: [{ type: \"text\", text: JSON.stringify(data, null, 2) }] };\n    }\n  );\n\n  server.tool(\n    \"search_products\",\n    \"Search products by name across all shops\",\n    { query: z.string().describe(\"Search query for product name\") },\n    async ({ query }) => {\n      const data = await subgraph.searchProducts(query);\n      return { content: [{ type: \"text\", text: JSON.stringify(data, null, 2) }] };\n    }\n  );\n}\n","export const DEFAULTS = {\n  RPC_URL: \"https://sepolia.optimism.io\",\n  HUB_ADDRESS: \"0x479bcD43394867983d7dAE0b7280c251dFa0b935\" as `0x${string}`,\n  SUBGRAPH_URL:\n    \"https://api.studio.thegraph.com/query/958/onchain-commerce/v0.0.1\",\n  CHAIN_ID: 11155420,\n} as const;\n\nexport function getConfig() {\n  return {\n    rpcUrl: process.env.COMMERCE_RPC_URL || DEFAULTS.RPC_URL,\n    privateKey: process.env.COMMERCE_PRIVATE_KEY as `0x${string}` | undefined,\n    hubAddress: (process.env.COMMERCE_HUB_ADDRESS ||\n      DEFAULTS.HUB_ADDRESS) as `0x${string}`,\n    subgraphUrl:\n      process.env.COMMERCE_SUBGRAPH_URL || DEFAULTS.SUBGRAPH_URL,\n  };\n}\n","import { getConfig } from \"./types.js\";\n\nasync function query(q: string, variables?: Record<string, unknown>) {\n  const { subgraphUrl } = getConfig();\n  const res = await fetch(subgraphUrl, {\n    method: \"POST\",\n    headers: { \"Content-Type\": \"application/json\" },\n    body: JSON.stringify({ query: q, variables }),\n  });\n  const json = (await res.json()) as { data?: unknown; errors?: { message: string }[] };\n  if (json.errors) throw new Error(json.errors.map((e) => e.message).join(\", \"));\n  return json.data as Record<string, unknown>;\n}\n\nexport async function listShops() {\n  return query(`{\n    shops(first: 100) {\n      id address owner name metadataURI createdAt\n      products { id }\n      orders { id }\n    }\n  }`);\n}\n\nexport async function getShop(address: string) {\n  const id = address.toLowerCase();\n  return query(\n    `query($id: ID!) {\n      shop(id: $id) {\n        id address owner name metadataURI createdAt paymentSplitAddress\n        products(first: 100) {\n          id productId name price stock category { id name } metadataURI active\n          variants { id variantId name price stock active }\n        }\n        categories(first: 100) { id categoryId name metadataURI active }\n        collections(first: 100) { id collectionId name productIds metadataURI active }\n        orders(first: 100, orderBy: createdAt, orderDirection: desc) {\n          id orderId customer { address } totalAmount status createdAt\n          items { product { productId name } variant { variantId name } quantity }\n        }\n        reviews(first: 100) { id reviewId rating metadataURI createdAt customer { address } order { orderId } }\n        discounts(first: 100) { id discountId code basisPoints maxUses usedCount expiresAt active }\n      }\n    }`,\n    { id }\n  );\n}\n\nexport async function getProduct(shopAddress: string, productId: string) {\n  const id = `${shopAddress.toLowerCase()}-${productId}`;\n  return query(\n    `query($id: ID!) {\n      product(id: $id) {\n        id productId name price stock category { id name } metadataURI active createdAt\n        shop { address name }\n        variants { id variantId name price stock active }\n      }\n    }`,\n    { id }\n  );\n}\n\nexport async function getOrders(customerAddress: string) {\n  const id = customerAddress.toLowerCase();\n  return query(\n    `query($id: ID!) {\n      customer(id: $id) {\n        address\n        orders(first: 100, orderBy: createdAt, orderDirection: desc) {\n          id orderId shop { address name } totalAmount status createdAt\n          items { product { productId name } variant { variantId name } quantity }\n        }\n        reviews { id reviewId rating shop { address name } order { orderId } }\n      }\n    }`,\n    { id }\n  );\n}\n\nexport async function searchProducts(searchName: string) {\n  // The Graph supports name_contains_nocase for text search\n  return query(\n    `query($name: String!) {\n      products(first: 50, where: { name_contains_nocase: $name, active: true }) {\n        id productId name price stock metadataURI active\n        shop { address name }\n        category { name }\n        variants { variantId name price stock active }\n      }\n    }`,\n    { name: searchName }\n  );\n}\n\nexport async function getProductPrices(\n  shopAddress: string,\n  items: { productId: string; variantId: string }[]\n) {\n  // Fetch product and variant prices for order total calculation\n  const productIds = [...new Set(items.map((i) => `${shopAddress.toLowerCase()}-${i.productId}`))];\n  const data = await query(\n    `query($ids: [ID!]!) {\n      products(where: { id_in: $ids }) {\n        id productId price\n        variants { variantId price }\n      }\n    }`,\n    { ids: productIds }\n  );\n  return data.products as Array<{\n    productId: string;\n    price: string;\n    variants: Array<{ variantId: string; price: string }>;\n  }>;\n}\n","import { McpServer } from \"@modelcontextprotocol/sdk/server/mcp.js\";\nimport { z } from \"zod\";\nimport { parseEther, formatEther, decodeEventLog } from \"viem\";\nimport { shopAbi } from \"../abis/Shop.js\";\nimport { getPublicClient, getWalletClient, getAccount } from \"../client.js\";\nimport { getProductPrices } from \"../subgraph.js\";\n\nexport function registerWriteTools(server: McpServer) {\n  server.tool(\n    \"create_order\",\n    \"Purchase items from a shop. Calculates total price from product/variant prices and sends ETH.\",\n    {\n      shopAddress: z.string().describe(\"Shop contract address\"),\n      items: z\n        .array(\n          z.object({\n            productId: z.string().describe(\"Product ID\"),\n            variantId: z.string().describe(\"Variant ID (use '0' for no variant)\"),\n            quantity: z.number().int().positive().describe(\"Quantity to purchase\"),\n          })\n        )\n        .describe(\"Array of items to purchase\"),\n    },\n    async ({ shopAddress, items }) => {\n      const publicClient = getPublicClient();\n      const walletClient = getWalletClient();\n      const account = getAccount();\n\n      // Fetch prices from subgraph\n      const products = await getProductPrices(shopAddress, items);\n\n      // Calculate total\n      let total = 0n;\n      for (const item of items) {\n        const product = products.find((p) => p.productId === item.productId);\n        if (!product) throw new Error(`Product ${item.productId} not found`);\n\n        let price: bigint;\n        if (item.variantId !== \"0\") {\n          const variant = product.variants.find(\n            (v) => v.variantId === item.variantId\n          );\n          if (!variant) throw new Error(`Variant ${item.variantId} not found for product ${item.productId}`);\n          price = BigInt(variant.price);\n        } else {\n          price = BigInt(product.price);\n        }\n        total += price * BigInt(item.quantity);\n      }\n\n      const orderItems = items.map((i) => ({\n        productId: BigInt(i.productId),\n        variantId: BigInt(i.variantId),\n        quantity: BigInt(i.quantity),\n      }));\n\n      const hash = await walletClient.writeContract({\n        address: shopAddress as `0x${string}`,\n        abi: shopAbi,\n        functionName: \"createOrder\",\n        args: [orderItems],\n        value: total,\n        account,\n        chain: walletClient.chain,\n      });\n\n      const receipt = await publicClient.waitForTransactionReceipt({ hash });\n\n      // Extract order ID from event\n      let orderId: string | undefined;\n      for (const log of receipt.logs) {\n        try {\n          const event = decodeEventLog({\n            abi: shopAbi,\n            data: log.data,\n            topics: log.topics,\n          });\n          if (event.eventName === \"OrderCreated\") {\n            orderId = (event.args as { orderId: bigint }).orderId.toString();\n          }\n        } catch {\n          // not our event\n        }\n      }\n\n      return {\n        content: [\n          {\n            type: \"text\",\n            text: JSON.stringify({\n              success: true,\n              txHash: hash,\n              orderId,\n              totalPaid: formatEther(total) + \" ETH\",\n              blockNumber: receipt.blockNumber.toString(),\n            }, null, 2),\n          },\n        ],\n      };\n    }\n  );\n\n  server.tool(\n    \"cancel_order\",\n    \"Cancel an order (if not yet fulfilled)\",\n    {\n      shopAddress: z.string().describe(\"Shop contract address\"),\n      orderId: z.string().describe(\"Order ID to cancel\"),\n    },\n    async ({ shopAddress, orderId }) => {\n      const walletClient = getWalletClient();\n      const publicClient = getPublicClient();\n      const account = getAccount();\n\n      const hash = await walletClient.writeContract({\n        address: shopAddress as `0x${string}`,\n        abi: shopAbi,\n        functionName: \"cancelOrder\",\n        args: [BigInt(orderId)],\n        account,\n        chain: walletClient.chain,\n      });\n\n      const receipt = await publicClient.waitForTransactionReceipt({ hash });\n\n      return {\n        content: [\n          {\n            type: \"text\",\n            text: JSON.stringify({\n              success: true,\n              txHash: hash,\n              orderId,\n              blockNumber: receipt.blockNumber.toString(),\n            }, null, 2),\n          },\n        ],\n      };\n    }\n  );\n\n  server.tool(\n    \"leave_review\",\n    \"Leave a review for a fulfilled order (rating 1-5)\",\n    {\n      shopAddress: z.string().describe(\"Shop contract address\"),\n      orderId: z.string().describe(\"Order ID to review\"),\n      rating: z.number().int().min(1).max(5).describe(\"Rating from 1 to 5\"),\n      text: z.string().describe(\"Review text (stored as metadataURI)\"),\n    },\n    async ({ shopAddress, orderId, rating, text }) => {\n      const walletClient = getWalletClient();\n      const publicClient = getPublicClient();\n      const account = getAccount();\n\n      const hash = await walletClient.writeContract({\n        address: shopAddress as `0x${string}`,\n        abi: shopAbi,\n        functionName: \"leaveReview\",\n        args: [BigInt(orderId), rating, text],\n        account,\n        chain: walletClient.chain,\n      });\n\n      const receipt = await publicClient.waitForTransactionReceipt({ hash });\n\n      let reviewId: string | undefined;\n      for (const log of receipt.logs) {\n        try {\n          const event = decodeEventLog({\n            abi: shopAbi,\n            data: log.data,\n            topics: log.topics,\n          });\n          if (event.eventName === \"ReviewCreated\") {\n            reviewId = (event.args as { reviewId: bigint }).reviewId.toString();\n          }\n        } catch {\n          // not our event\n        }\n      }\n\n      return {\n        content: [\n          {\n            type: \"text\",\n            text: JSON.stringify({\n              success: true,\n              txHash: hash,\n              reviewId,\n              blockNumber: receipt.blockNumber.toString(),\n            }, null, 2),\n          },\n        ],\n      };\n    }\n  );\n}\n","export const shopAbi = [\n  {\n    type: \"function\",\n    name: \"createOrder\",\n    inputs: [\n      {\n        name: \"items\",\n        type: \"tuple[]\",\n        components: [\n          { name: \"productId\", type: \"uint256\" },\n          { name: \"variantId\", type: \"uint256\" },\n          { name: \"quantity\", type: \"uint256\" },\n        ],\n      },\n    ],\n    outputs: [{ name: \"orderId\", type: \"uint256\" }],\n    stateMutability: \"payable\",\n  },\n  {\n    type: \"function\",\n    name: \"cancelOrder\",\n    inputs: [{ name: \"orderId\", type: \"uint256\" }],\n    outputs: [],\n    stateMutability: \"nonpayable\",\n  },\n  {\n    type: \"function\",\n    name: \"fulfillOrder\",\n    inputs: [{ name: \"orderId\", type: \"uint256\" }],\n    outputs: [],\n    stateMutability: \"nonpayable\",\n  },\n  {\n    type: \"function\",\n    name: \"leaveReview\",\n    inputs: [\n      { name: \"orderId\", type: \"uint256\" },\n      { name: \"rating\", type: \"uint8\" },\n      { name: \"_metadataURI\", type: \"string\" },\n    ],\n    outputs: [{ name: \"reviewId\", type: \"uint256\" }],\n    stateMutability: \"nonpayable\",\n  },\n  {\n    type: \"function\",\n    name: \"createProduct\",\n    inputs: [\n      { name: \"_name\", type: \"string\" },\n      { name: \"_price\", type: \"uint256\" },\n      { name: \"_stock\", type: \"uint256\" },\n      { name: \"_categoryId\", type: \"uint256\" },\n      { name: \"_metadataURI\", type: \"string\" },\n    ],\n    outputs: [{ name: \"productId\", type: \"uint256\" }],\n    stateMutability: \"nonpayable\",\n  },\n  {\n    type: \"function\",\n    name: \"createCategory\",\n    inputs: [\n      { name: \"_name\", type: \"string\" },\n      { name: \"_metadataURI\", type: \"string\" },\n    ],\n    outputs: [{ name: \"categoryId\", type: \"uint256\" }],\n    stateMutability: \"nonpayable\",\n  },\n  {\n    type: \"function\",\n    name: \"createDiscount\",\n    inputs: [\n      { name: \"code\", type: \"bytes32\" },\n      { name: \"basisPoints\", type: \"uint256\" },\n      { name: \"maxUses\", type: \"uint256\" },\n      { name: \"expiresAt\", type: \"uint256\" },\n    ],\n    outputs: [{ name: \"discountId\", type: \"uint256\" }],\n    stateMutability: \"nonpayable\",\n  },\n  {\n    type: \"function\",\n    name: \"products\",\n    inputs: [{ name: \"\", type: \"uint256\" }],\n    outputs: [\n      { name: \"name\", type: \"string\" },\n      { name: \"price\", type: \"uint256\" },\n      { name: \"stock\", type: \"uint256\" },\n      { name: \"categoryId\", type: \"uint256\" },\n      { name: \"metadataURI\", type: \"string\" },\n      { name: \"active\", type: \"bool\" },\n    ],\n    stateMutability: \"view\",\n  },\n  {\n    type: \"function\",\n    name: \"variants\",\n    inputs: [\n      { name: \"\", type: \"uint256\" },\n      { name: \"\", type: \"uint256\" },\n    ],\n    outputs: [\n      { name: \"name\", type: \"string\" },\n      { name: \"price\", type: \"uint256\" },\n      { name: \"stock\", type: \"uint256\" },\n      { name: \"active\", type: \"bool\" },\n    ],\n    stateMutability: \"view\",\n  },\n  {\n    type: \"function\",\n    name: \"name\",\n    inputs: [],\n    outputs: [{ name: \"\", type: \"string\" }],\n    stateMutability: \"view\",\n  },\n  {\n    type: \"event\",\n    name: \"OrderCreated\",\n    inputs: [\n      { name: \"orderId\", type: \"uint256\", indexed: true },\n      { name: \"customer\", type: \"address\", indexed: true },\n      { name: \"totalAmount\", type: \"uint256\", indexed: false },\n    ],\n    anonymous: false,\n  },\n  {\n    type: \"event\",\n    name: \"OrderCancelled\",\n    inputs: [{ name: \"orderId\", type: \"uint256\", indexed: true }],\n    anonymous: false,\n  },\n  {\n    type: \"event\",\n    name: \"OrderFulfilled\",\n    inputs: [{ name: \"orderId\", type: \"uint256\", indexed: true }],\n    anonymous: false,\n  },\n  {\n    type: \"event\",\n    name: \"ReviewCreated\",\n    inputs: [\n      { name: \"reviewId\", type: \"uint256\", indexed: true },\n      { name: \"orderId\", type: \"uint256\", indexed: true },\n      { name: \"customer\", type: \"address\", indexed: true },\n      { name: \"rating\", type: \"uint8\", indexed: false },\n    ],\n    anonymous: false,\n  },\n  {\n    type: \"event\",\n    name: \"ProductCreated\",\n    inputs: [\n      { name: \"productId\", type: \"uint256\", indexed: true },\n      { name: \"name\", type: \"string\", indexed: false },\n      { name: \"price\", type: \"uint256\", indexed: false },\n      { name: \"stock\", type: \"uint256\", indexed: false },\n      { name: \"categoryId\", type: \"uint256\", indexed: false },\n    ],\n    anonymous: false,\n  },\n  {\n    type: \"event\",\n    name: \"CategoryCreated\",\n    inputs: [\n      { name: \"categoryId\", type: \"uint256\", indexed: true },\n      { name: \"name\", type: \"string\", indexed: false },\n    ],\n    anonymous: false,\n  },\n  {\n    type: \"event\",\n    name: \"DiscountCreated\",\n    inputs: [\n      { name: \"discountId\", type: \"uint256\", indexed: true },\n      { name: \"code\", type: \"bytes32\", indexed: false },\n      { name: \"basisPoints\", type: \"uint256\", indexed: false },\n      { name: \"maxUses\", type: \"uint256\", indexed: false },\n      { name: \"expiresAt\", type: \"uint256\", indexed: false },\n    ],\n    anonymous: false,\n  },\n] as const;\n","import {\n  createPublicClient,\n  createWalletClient,\n  http,\n  type PublicClient,\n  type WalletClient,\n  type Chain,\n} from \"viem\";\nimport { privateKeyToAccount } from \"viem/accounts\";\nimport { getConfig } from \"./types.js\";\n\nconst opSepolia: Chain = {\n  id: 11155420,\n  name: \"OP Sepolia\",\n  nativeCurrency: { name: \"Ether\", symbol: \"ETH\", decimals: 18 },\n  rpcUrls: {\n    default: { http: [\"https://sepolia.optimism.io\"] },\n  },\n  blockExplorers: {\n    default: { name: \"Blockscout\", url: \"https://optimism-sepolia.blockscout.com\" },\n  },\n  testnet: true,\n};\n\nlet _publicClient: PublicClient | null = null;\nlet _walletClient: WalletClient | null = null;\n\nexport function getPublicClient(): PublicClient {\n  if (!_publicClient) {\n    const { rpcUrl } = getConfig();\n    _publicClient = createPublicClient({\n      chain: opSepolia,\n      transport: http(rpcUrl),\n    });\n  }\n  return _publicClient;\n}\n\nexport function getWalletClient(): WalletClient {\n  if (!_walletClient) {\n    const { rpcUrl, privateKey } = getConfig();\n    if (!privateKey) {\n      throw new Error(\n        \"COMMERCE_PRIVATE_KEY env var is required for write operations\"\n      );\n    }\n    const account = privateKeyToAccount(privateKey);\n    _walletClient = createWalletClient({\n      chain: opSepolia,\n      transport: http(rpcUrl),\n      account,\n    });\n  }\n  return _walletClient;\n}\n\nexport function getAccount() {\n  const { privateKey } = getConfig();\n  if (!privateKey) {\n    throw new Error(\"COMMERCE_PRIVATE_KEY env var is required for write operations\");\n  }\n  return privateKeyToAccount(privateKey);\n}\n","import { McpServer } from \"@modelcontextprotocol/sdk/server/mcp.js\";\nimport { z } from \"zod\";\nimport { decodeEventLog, parseEther, stringToHex, padHex } from \"viem\";\nimport { shopAbi } from \"../abis/Shop.js\";\nimport { commerceHubAbi } from \"../abis/CommerceHub.js\";\nimport { getPublicClient, getWalletClient, getAccount } from \"../client.js\";\nimport { getConfig } from \"../types.js\";\n\nexport function registerAdminTools(server: McpServer) {\n  server.tool(\n    \"create_shop\",\n    \"Create a new shop via the CommerceHub\",\n    {\n      name: z.string().describe(\"Shop name\"),\n      metadataURI: z.string().describe(\"Metadata URI for the shop\"),\n    },\n    async ({ name, metadataURI }) => {\n      const walletClient = getWalletClient();\n      const publicClient = getPublicClient();\n      const account = getAccount();\n      const { hubAddress } = getConfig();\n\n      const hash = await walletClient.writeContract({\n        address: hubAddress,\n        abi: commerceHubAbi,\n        functionName: \"createShop\",\n        args: [name, metadataURI],\n        account,\n        chain: walletClient.chain,\n      });\n\n      const receipt = await publicClient.waitForTransactionReceipt({ hash });\n\n      let shopAddress: string | undefined;\n      for (const log of receipt.logs) {\n        try {\n          const event = decodeEventLog({\n            abi: commerceHubAbi,\n            data: log.data,\n            topics: log.topics,\n          });\n          if (event.eventName === \"ShopCreated\") {\n            shopAddress = (event.args as { shop: string }).shop;\n          }\n        } catch {\n          // not our event\n        }\n      }\n\n      return {\n        content: [{\n          type: \"text\",\n          text: JSON.stringify({ success: true, txHash: hash, shopAddress, blockNumber: receipt.blockNumber.toString() }, null, 2),\n        }],\n      };\n    }\n  );\n\n  server.tool(\n    \"create_product\",\n    \"Add a product to a shop\",\n    {\n      shopAddress: z.string().describe(\"Shop contract address\"),\n      name: z.string().describe(\"Product name\"),\n      priceEth: z.string().describe(\"Price in ETH (e.g. '0.01')\"),\n      stock: z.number().int().nonnegative().describe(\"Initial stock\"),\n      categoryId: z.string().default(\"0\").describe(\"Category ID (0 for uncategorized)\"),\n      metadataURI: z.string().default(\"\").describe(\"Metadata URI\"),\n    },\n    async ({ shopAddress, name, priceEth, stock, categoryId, metadataURI }) => {\n      const walletClient = getWalletClient();\n      const publicClient = getPublicClient();\n      const account = getAccount();\n\n      const hash = await walletClient.writeContract({\n        address: shopAddress as `0x${string}`,\n        abi: shopAbi,\n        functionName: \"createProduct\",\n        args: [name, parseEther(priceEth), BigInt(stock), BigInt(categoryId), metadataURI],\n        account,\n        chain: walletClient.chain,\n      });\n\n      const receipt = await publicClient.waitForTransactionReceipt({ hash });\n\n      let productId: string | undefined;\n      for (const log of receipt.logs) {\n        try {\n          const event = decodeEventLog({ abi: shopAbi, data: log.data, topics: log.topics });\n          if (event.eventName === \"ProductCreated\") {\n            productId = (event.args as { productId: bigint }).productId.toString();\n          }\n        } catch {}\n      }\n\n      return {\n        content: [{\n          type: \"text\",\n          text: JSON.stringify({ success: true, txHash: hash, productId, blockNumber: receipt.blockNumber.toString() }, null, 2),\n        }],\n      };\n    }\n  );\n\n  server.tool(\n    \"create_category\",\n    \"Add a category to a shop\",\n    {\n      shopAddress: z.string().describe(\"Shop contract address\"),\n      name: z.string().describe(\"Category name\"),\n      metadataURI: z.string().default(\"\").describe(\"Metadata URI\"),\n    },\n    async ({ shopAddress, name, metadataURI }) => {\n      const walletClient = getWalletClient();\n      const publicClient = getPublicClient();\n      const account = getAccount();\n\n      const hash = await walletClient.writeContract({\n        address: shopAddress as `0x${string}`,\n        abi: shopAbi,\n        functionName: \"createCategory\",\n        args: [name, metadataURI],\n        account,\n        chain: walletClient.chain,\n      });\n\n      const receipt = await publicClient.waitForTransactionReceipt({ hash });\n\n      let categoryId: string | undefined;\n      for (const log of receipt.logs) {\n        try {\n          const event = decodeEventLog({ abi: shopAbi, data: log.data, topics: log.topics });\n          if (event.eventName === \"CategoryCreated\") {\n            categoryId = (event.args as { categoryId: bigint }).categoryId.toString();\n          }\n        } catch {}\n      }\n\n      return {\n        content: [{\n          type: \"text\",\n          text: JSON.stringify({ success: true, txHash: hash, categoryId, blockNumber: receipt.blockNumber.toString() }, null, 2),\n        }],\n      };\n    }\n  );\n\n  server.tool(\n    \"fulfill_order\",\n    \"Mark an order as fulfilled (shop owner/manager only)\",\n    {\n      shopAddress: z.string().describe(\"Shop contract address\"),\n      orderId: z.string().describe(\"Order ID to fulfill\"),\n    },\n    async ({ shopAddress, orderId }) => {\n      const walletClient = getWalletClient();\n      const publicClient = getPublicClient();\n      const account = getAccount();\n\n      const hash = await walletClient.writeContract({\n        address: shopAddress as `0x${string}`,\n        abi: shopAbi,\n        functionName: \"fulfillOrder\",\n        args: [BigInt(orderId)],\n        account,\n        chain: walletClient.chain,\n      });\n\n      const receipt = await publicClient.waitForTransactionReceipt({ hash });\n\n      return {\n        content: [{\n          type: \"text\",\n          text: JSON.stringify({ success: true, txHash: hash, orderId, blockNumber: receipt.blockNumber.toString() }, null, 2),\n        }],\n      };\n    }\n  );\n\n  server.tool(\n    \"create_discount\",\n    \"Create a discount code for a shop\",\n    {\n      shopAddress: z.string().describe(\"Shop contract address\"),\n      code: z.string().describe(\"Discount code string\"),\n      basisPoints: z.number().int().min(1).max(10000).describe(\"Discount in basis points (100 = 1%)\"),\n      maxUses: z.number().int().positive().describe(\"Maximum number of uses\"),\n      expiresAt: z.number().int().describe(\"Expiry timestamp (unix seconds, 0 for no expiry)\"),\n    },\n    async ({ shopAddress, code, basisPoints, maxUses, expiresAt }) => {\n      const walletClient = getWalletClient();\n      const publicClient = getPublicClient();\n      const account = getAccount();\n\n      // Convert code string to bytes32\n      const codeHex = stringToHex(code, { size: 32 });\n\n      const hash = await walletClient.writeContract({\n        address: shopAddress as `0x${string}`,\n        abi: shopAbi,\n        functionName: \"createDiscount\",\n        args: [codeHex, BigInt(basisPoints), BigInt(maxUses), BigInt(expiresAt)],\n        account,\n        chain: walletClient.chain,\n      });\n\n      const receipt = await publicClient.waitForTransactionReceipt({ hash });\n\n      let discountId: string | undefined;\n      for (const log of receipt.logs) {\n        try {\n          const event = decodeEventLog({ abi: shopAbi, data: log.data, topics: log.topics });\n          if (event.eventName === \"DiscountCreated\") {\n            discountId = (event.args as { discountId: bigint }).discountId.toString();\n          }\n        } catch {}\n      }\n\n      return {\n        content: [{\n          type: \"text\",\n          text: JSON.stringify({ success: true, txHash: hash, discountId, code, blockNumber: receipt.blockNumber.toString() }, null, 2),\n        }],\n      };\n    }\n  );\n}\n","export const commerceHubAbi = [\n  {\n    type: \"function\",\n    name: \"createShop\",\n    inputs: [\n      { name: \"name\", type: \"string\" },\n      { name: \"metadataURI\", type: \"string\" },\n    ],\n    outputs: [{ name: \"shop\", type: \"address\" }],\n    stateMutability: \"nonpayable\",\n  },\n  {\n    type: \"function\",\n    name: \"getShops\",\n    inputs: [],\n    outputs: [{ name: \"\", type: \"address[]\" }],\n    stateMutability: \"view\",\n  },\n  {\n    type: \"function\",\n    name: \"isShop\",\n    inputs: [{ name: \"\", type: \"address\" }],\n    outputs: [{ name: \"\", type: \"bool\" }],\n    stateMutability: \"view\",\n  },\n  {\n    type: \"function\",\n    name: \"shopCount\",\n    inputs: [],\n    outputs: [{ name: \"\", type: \"uint256\" }],\n    stateMutability: \"view\",\n  },\n  {\n    type: \"function\",\n    name: \"protocolFee\",\n    inputs: [],\n    outputs: [{ name: \"\", type: \"uint256\" }],\n    stateMutability: \"view\",\n  },\n  {\n    type: \"event\",\n    name: \"ShopCreated\",\n    inputs: [\n      { name: \"shop\", type: \"address\", indexed: true },\n      { name: \"owner\", type: \"address\", indexed: true },\n      { name: \"name\", type: \"string\", indexed: false },\n    ],\n    anonymous: false,\n  },\n] as const;\n"],"mappings":";;;AAAA,SAAS,iBAAiB;AAC1B,SAAS,4BAA4B;;;ACArC,SAAS,SAAS;;;ACDX,IAAM,WAAW;AAAA,EACtB,SAAS;AAAA,EACT,aAAa;AAAA,EACb,cACE;AAAA,EACF,UAAU;AACZ;AAEO,SAAS,YAAY;AAC1B,SAAO;AAAA,IACL,QAAQ,QAAQ,IAAI,oBAAoB,SAAS;AAAA,IACjD,YAAY,QAAQ,IAAI;AAAA,IACxB,YAAa,QAAQ,IAAI,wBACvB,SAAS;AAAA,IACX,aACE,QAAQ,IAAI,yBAAyB,SAAS;AAAA,EAClD;AACF;;;ACfA,eAAe,MAAM,GAAW,WAAqC;AACnE,QAAM,EAAE,YAAY,IAAI,UAAU;AAClC,QAAM,MAAM,MAAM,MAAM,aAAa;AAAA,IACnC,QAAQ;AAAA,IACR,SAAS,EAAE,gBAAgB,mBAAmB;AAAA,IAC9C,MAAM,KAAK,UAAU,EAAE,OAAO,GAAG,UAAU,CAAC;AAAA,EAC9C,CAAC;AACD,QAAM,OAAQ,MAAM,IAAI,KAAK;AAC7B,MAAI,KAAK,OAAQ,OAAM,IAAI,MAAM,KAAK,OAAO,IAAI,CAAC,MAAM,EAAE,OAAO,EAAE,KAAK,IAAI,CAAC;AAC7E,SAAO,KAAK;AACd;AAEA,eAAsB,YAAY;AAChC,SAAO,MAAM;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IAMX;AACJ;AAEA,eAAsB,QAAQ,SAAiB;AAC7C,QAAM,KAAK,QAAQ,YAAY;AAC/B,SAAO;AAAA,IACL;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IAiBA,EAAE,GAAG;AAAA,EACP;AACF;AAEA,eAAsB,WAAW,aAAqB,WAAmB;AACvE,QAAM,KAAK,GAAG,YAAY,YAAY,CAAC,IAAI,SAAS;AACpD,SAAO;AAAA,IACL;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IAOA,EAAE,GAAG;AAAA,EACP;AACF;AAEA,eAAsB,UAAU,iBAAyB;AACvD,QAAM,KAAK,gBAAgB,YAAY;AACvC,SAAO;AAAA,IACL;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IAUA,EAAE,GAAG;AAAA,EACP;AACF;AAEA,eAAsB,eAAe,YAAoB;AAEvD,SAAO;AAAA,IACL;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IAQA,EAAE,MAAM,WAAW;AAAA,EACrB;AACF;AAEA,eAAsB,iBACpB,aACA,OACA;AAEA,QAAM,aAAa,CAAC,GAAG,IAAI,IAAI,MAAM,IAAI,CAAC,MAAM,GAAG,YAAY,YAAY,CAAC,IAAI,EAAE,SAAS,EAAE,CAAC,CAAC;AAC/F,QAAM,OAAO,MAAM;AAAA,IACjB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IAMA,EAAE,KAAK,WAAW;AAAA,EACpB;AACA,SAAO,KAAK;AAKd;;;AF9GO,SAAS,kBAAkBA,SAAmB;AACnD,EAAAA,QAAO;AAAA,IACL;AAAA,IACA;AAAA,IACA,CAAC;AAAA,IACD,YAAY;AACV,YAAM,OAAO,MAAe,UAAU;AACtC,aAAO,EAAE,SAAS,CAAC,EAAE,MAAM,QAAQ,MAAM,KAAK,UAAU,MAAM,MAAM,CAAC,EAAE,CAAC,EAAE;AAAA,IAC5E;AAAA,EACF;AAEA,EAAAA,QAAO;AAAA,IACL;AAAA,IACA;AAAA,IACA,EAAE,aAAa,EAAE,OAAO,EAAE,SAAS,uBAAuB,EAAE;AAAA,IAC5D,OAAO,EAAE,YAAY,MAAM;AACzB,YAAM,OAAO,MAAe,QAAQ,WAAW;AAC/C,aAAO,EAAE,SAAS,CAAC,EAAE,MAAM,QAAQ,MAAM,KAAK,UAAU,MAAM,MAAM,CAAC,EAAE,CAAC,EAAE;AAAA,IAC5E;AAAA,EACF;AAEA,EAAAA,QAAO;AAAA,IACL;AAAA,IACA;AAAA,IACA;AAAA,MACE,aAAa,EAAE,OAAO,EAAE,SAAS,uBAAuB;AAAA,MACxD,WAAW,EAAE,OAAO,EAAE,SAAS,YAAY;AAAA,IAC7C;AAAA,IACA,OAAO,EAAE,aAAa,UAAU,MAAM;AACpC,YAAM,OAAO,MAAe,WAAW,aAAa,SAAS;AAC7D,aAAO,EAAE,SAAS,CAAC,EAAE,MAAM,QAAQ,MAAM,KAAK,UAAU,MAAM,MAAM,CAAC,EAAE,CAAC,EAAE;AAAA,IAC5E;AAAA,EACF;AAEA,EAAAA,QAAO;AAAA,IACL;AAAA,IACA;AAAA,IACA,EAAE,iBAAiB,EAAE,OAAO,EAAE,SAAS,yBAAyB,EAAE;AAAA,IAClE,OAAO,EAAE,gBAAgB,MAAM;AAC7B,YAAM,OAAO,MAAe,UAAU,eAAe;AACrD,aAAO,EAAE,SAAS,CAAC,EAAE,MAAM,QAAQ,MAAM,KAAK,UAAU,MAAM,MAAM,CAAC,EAAE,CAAC,EAAE;AAAA,IAC5E;AAAA,EACF;AAEA,EAAAA,QAAO;AAAA,IACL;AAAA,IACA;AAAA,IACA,EAAE,OAAO,EAAE,OAAO,EAAE,SAAS,+BAA+B,EAAE;AAAA,IAC9D,OAAO,EAAE,OAAAC,OAAM,MAAM;AACnB,YAAM,OAAO,MAAe,eAAeA,MAAK;AAChD,aAAO,EAAE,SAAS,CAAC,EAAE,MAAM,QAAQ,MAAM,KAAK,UAAU,MAAM,MAAM,CAAC,EAAE,CAAC,EAAE;AAAA,IAC5E;AAAA,EACF;AACF;;;AGxDA,SAAS,KAAAC,UAAS;AAClB,SAAqB,aAAa,sBAAsB;;;ACFjD,IAAM,UAAU;AAAA,EACrB;AAAA,IACE,MAAM;AAAA,IACN,MAAM;AAAA,IACN,QAAQ;AAAA,MACN;AAAA,QACE,MAAM;AAAA,QACN,MAAM;AAAA,QACN,YAAY;AAAA,UACV,EAAE,MAAM,aAAa,MAAM,UAAU;AAAA,UACrC,EAAE,MAAM,aAAa,MAAM,UAAU;AAAA,UACrC,EAAE,MAAM,YAAY,MAAM,UAAU;AAAA,QACtC;AAAA,MACF;AAAA,IACF;AAAA,IACA,SAAS,CAAC,EAAE,MAAM,WAAW,MAAM,UAAU,CAAC;AAAA,IAC9C,iBAAiB;AAAA,EACnB;AAAA,EACA;AAAA,IACE,MAAM;AAAA,IACN,MAAM;AAAA,IACN,QAAQ,CAAC,EAAE,MAAM,WAAW,MAAM,UAAU,CAAC;AAAA,IAC7C,SAAS,CAAC;AAAA,IACV,iBAAiB;AAAA,EACnB;AAAA,EACA;AAAA,IACE,MAAM;AAAA,IACN,MAAM;AAAA,IACN,QAAQ,CAAC,EAAE,MAAM,WAAW,MAAM,UAAU,CAAC;AAAA,IAC7C,SAAS,CAAC;AAAA,IACV,iBAAiB;AAAA,EACnB;AAAA,EACA;AAAA,IACE,MAAM;AAAA,IACN,MAAM;AAAA,IACN,QAAQ;AAAA,MACN,EAAE,MAAM,WAAW,MAAM,UAAU;AAAA,MACnC,EAAE,MAAM,UAAU,MAAM,QAAQ;AAAA,MAChC,EAAE,MAAM,gBAAgB,MAAM,SAAS;AAAA,IACzC;AAAA,IACA,SAAS,CAAC,EAAE,MAAM,YAAY,MAAM,UAAU,CAAC;AAAA,IAC/C,iBAAiB;AAAA,EACnB;AAAA,EACA;AAAA,IACE,MAAM;AAAA,IACN,MAAM;AAAA,IACN,QAAQ;AAAA,MACN,EAAE,MAAM,SAAS,MAAM,SAAS;AAAA,MAChC,EAAE,MAAM,UAAU,MAAM,UAAU;AAAA,MAClC,EAAE,MAAM,UAAU,MAAM,UAAU;AAAA,MAClC,EAAE,MAAM,eAAe,MAAM,UAAU;AAAA,MACvC,EAAE,MAAM,gBAAgB,MAAM,SAAS;AAAA,IACzC;AAAA,IACA,SAAS,CAAC,EAAE,MAAM,aAAa,MAAM,UAAU,CAAC;AAAA,IAChD,iBAAiB;AAAA,EACnB;AAAA,EACA;AAAA,IACE,MAAM;AAAA,IACN,MAAM;AAAA,IACN,QAAQ;AAAA,MACN,EAAE,MAAM,SAAS,MAAM,SAAS;AAAA,MAChC,EAAE,MAAM,gBAAgB,MAAM,SAAS;AAAA,IACzC;AAAA,IACA,SAAS,CAAC,EAAE,MAAM,cAAc,MAAM,UAAU,CAAC;AAAA,IACjD,iBAAiB;AAAA,EACnB;AAAA,EACA;AAAA,IACE,MAAM;AAAA,IACN,MAAM;AAAA,IACN,QAAQ;AAAA,MACN,EAAE,MAAM,QAAQ,MAAM,UAAU;AAAA,MAChC,EAAE,MAAM,eAAe,MAAM,UAAU;AAAA,MACvC,EAAE,MAAM,WAAW,MAAM,UAAU;AAAA,MACnC,EAAE,MAAM,aAAa,MAAM,UAAU;AAAA,IACvC;AAAA,IACA,SAAS,CAAC,EAAE,MAAM,cAAc,MAAM,UAAU,CAAC;AAAA,IACjD,iBAAiB;AAAA,EACnB;AAAA,EACA;AAAA,IACE,MAAM;AAAA,IACN,MAAM;AAAA,IACN,QAAQ,CAAC,EAAE,MAAM,IAAI,MAAM,UAAU,CAAC;AAAA,IACtC,SAAS;AAAA,MACP,EAAE,MAAM,QAAQ,MAAM,SAAS;AAAA,MAC/B,EAAE,MAAM,SAAS,MAAM,UAAU;AAAA,MACjC,EAAE,MAAM,SAAS,MAAM,UAAU;AAAA,MACjC,EAAE,MAAM,cAAc,MAAM,UAAU;AAAA,MACtC,EAAE,MAAM,eAAe,MAAM,SAAS;AAAA,MACtC,EAAE,MAAM,UAAU,MAAM,OAAO;AAAA,IACjC;AAAA,IACA,iBAAiB;AAAA,EACnB;AAAA,EACA;AAAA,IACE,MAAM;AAAA,IACN,MAAM;AAAA,IACN,QAAQ;AAAA,MACN,EAAE,MAAM,IAAI,MAAM,UAAU;AAAA,MAC5B,EAAE,MAAM,IAAI,MAAM,UAAU;AAAA,IAC9B;AAAA,IACA,SAAS;AAAA,MACP,EAAE,MAAM,QAAQ,MAAM,SAAS;AAAA,MAC/B,EAAE,MAAM,SAAS,MAAM,UAAU;AAAA,MACjC,EAAE,MAAM,SAAS,MAAM,UAAU;AAAA,MACjC,EAAE,MAAM,UAAU,MAAM,OAAO;AAAA,IACjC;AAAA,IACA,iBAAiB;AAAA,EACnB;AAAA,EACA;AAAA,IACE,MAAM;AAAA,IACN,MAAM;AAAA,IACN,QAAQ,CAAC;AAAA,IACT,SAAS,CAAC,EAAE,MAAM,IAAI,MAAM,SAAS,CAAC;AAAA,IACtC,iBAAiB;AAAA,EACnB;AAAA,EACA;AAAA,IACE,MAAM;AAAA,IACN,MAAM;AAAA,IACN,QAAQ;AAAA,MACN,EAAE,MAAM,WAAW,MAAM,WAAW,SAAS,KAAK;AAAA,MAClD,EAAE,MAAM,YAAY,MAAM,WAAW,SAAS,KAAK;AAAA,MACnD,EAAE,MAAM,eAAe,MAAM,WAAW,SAAS,MAAM;AAAA,IACzD;AAAA,IACA,WAAW;AAAA,EACb;AAAA,EACA;AAAA,IACE,MAAM;AAAA,IACN,MAAM;AAAA,IACN,QAAQ,CAAC,EAAE,MAAM,WAAW,MAAM,WAAW,SAAS,KAAK,CAAC;AAAA,IAC5D,WAAW;AAAA,EACb;AAAA,EACA;AAAA,IACE,MAAM;AAAA,IACN,MAAM;AAAA,IACN,QAAQ,CAAC,EAAE,MAAM,WAAW,MAAM,WAAW,SAAS,KAAK,CAAC;AAAA,IAC5D,WAAW;AAAA,EACb;AAAA,EACA;AAAA,IACE,MAAM;AAAA,IACN,MAAM;AAAA,IACN,QAAQ;AAAA,MACN,EAAE,MAAM,YAAY,MAAM,WAAW,SAAS,KAAK;AAAA,MACnD,EAAE,MAAM,WAAW,MAAM,WAAW,SAAS,KAAK;AAAA,MAClD,EAAE,MAAM,YAAY,MAAM,WAAW,SAAS,KAAK;AAAA,MACnD,EAAE,MAAM,UAAU,MAAM,SAAS,SAAS,MAAM;AAAA,IAClD;AAAA,IACA,WAAW;AAAA,EACb;AAAA,EACA;AAAA,IACE,MAAM;AAAA,IACN,MAAM;AAAA,IACN,QAAQ;AAAA,MACN,EAAE,MAAM,aAAa,MAAM,WAAW,SAAS,KAAK;AAAA,MACpD,EAAE,MAAM,QAAQ,MAAM,UAAU,SAAS,MAAM;AAAA,MAC/C,EAAE,MAAM,SAAS,MAAM,WAAW,SAAS,MAAM;AAAA,MACjD,EAAE,MAAM,SAAS,MAAM,WAAW,SAAS,MAAM;AAAA,MACjD,EAAE,MAAM,cAAc,MAAM,WAAW,SAAS,MAAM;AAAA,IACxD;AAAA,IACA,WAAW;AAAA,EACb;AAAA,EACA;AAAA,IACE,MAAM;AAAA,IACN,MAAM;AAAA,IACN,QAAQ;AAAA,MACN,EAAE,MAAM,cAAc,MAAM,WAAW,SAAS,KAAK;AAAA,MACrD,EAAE,MAAM,QAAQ,MAAM,UAAU,SAAS,MAAM;AAAA,IACjD;AAAA,IACA,WAAW;AAAA,EACb;AAAA,EACA;AAAA,IACE,MAAM;AAAA,IACN,MAAM;AAAA,IACN,QAAQ;AAAA,MACN,EAAE,MAAM,cAAc,MAAM,WAAW,SAAS,KAAK;AAAA,MACrD,EAAE,MAAM,QAAQ,MAAM,WAAW,SAAS,MAAM;AAAA,MAChD,EAAE,MAAM,eAAe,MAAM,WAAW,SAAS,MAAM;AAAA,MACvD,EAAE,MAAM,WAAW,MAAM,WAAW,SAAS,MAAM;AAAA,MACnD,EAAE,MAAM,aAAa,MAAM,WAAW,SAAS,MAAM;AAAA,IACvD;AAAA,IACA,WAAW;AAAA,EACb;AACF;;;ACpLA;AAAA,EACE;AAAA,EACA;AAAA,EACA;AAAA,OAIK;AACP,SAAS,2BAA2B;AAGpC,IAAM,YAAmB;AAAA,EACvB,IAAI;AAAA,EACJ,MAAM;AAAA,EACN,gBAAgB,EAAE,MAAM,SAAS,QAAQ,OAAO,UAAU,GAAG;AAAA,EAC7D,SAAS;AAAA,IACP,SAAS,EAAE,MAAM,CAAC,6BAA6B,EAAE;AAAA,EACnD;AAAA,EACA,gBAAgB;AAAA,IACd,SAAS,EAAE,MAAM,cAAc,KAAK,0CAA0C;AAAA,EAChF;AAAA,EACA,SAAS;AACX;AAEA,IAAI,gBAAqC;AACzC,IAAI,gBAAqC;AAElC,SAAS,kBAAgC;AAC9C,MAAI,CAAC,eAAe;AAClB,UAAM,EAAE,OAAO,IAAI,UAAU;AAC7B,oBAAgB,mBAAmB;AAAA,MACjC,OAAO;AAAA,MACP,WAAW,KAAK,MAAM;AAAA,IACxB,CAAC;AAAA,EACH;AACA,SAAO;AACT;AAEO,SAAS,kBAAgC;AAC9C,MAAI,CAAC,eAAe;AAClB,UAAM,EAAE,QAAQ,WAAW,IAAI,UAAU;AACzC,QAAI,CAAC,YAAY;AACf,YAAM,IAAI;AAAA,QACR;AAAA,MACF;AAAA,IACF;AACA,UAAM,UAAU,oBAAoB,UAAU;AAC9C,oBAAgB,mBAAmB;AAAA,MACjC,OAAO;AAAA,MACP,WAAW,KAAK,MAAM;AAAA,MACtB;AAAA,IACF,CAAC;AAAA,EACH;AACA,SAAO;AACT;AAEO,SAAS,aAAa;AAC3B,QAAM,EAAE,WAAW,IAAI,UAAU;AACjC,MAAI,CAAC,YAAY;AACf,UAAM,IAAI,MAAM,+DAA+D;AAAA,EACjF;AACA,SAAO,oBAAoB,UAAU;AACvC;;;AFvDO,SAAS,mBAAmBC,SAAmB;AACpD,EAAAA,QAAO;AAAA,IACL;AAAA,IACA;AAAA,IACA;AAAA,MACE,aAAaC,GAAE,OAAO,EAAE,SAAS,uBAAuB;AAAA,MACxD,OAAOA,GACJ;AAAA,QACCA,GAAE,OAAO;AAAA,UACP,WAAWA,GAAE,OAAO,EAAE,SAAS,YAAY;AAAA,UAC3C,WAAWA,GAAE,OAAO,EAAE,SAAS,qCAAqC;AAAA,UACpE,UAAUA,GAAE,OAAO,EAAE,IAAI,EAAE,SAAS,EAAE,SAAS,sBAAsB;AAAA,QACvE,CAAC;AAAA,MACH,EACC,SAAS,4BAA4B;AAAA,IAC1C;AAAA,IACA,OAAO,EAAE,aAAa,MAAM,MAAM;AAChC,YAAM,eAAe,gBAAgB;AACrC,YAAM,eAAe,gBAAgB;AACrC,YAAM,UAAU,WAAW;AAG3B,YAAM,WAAW,MAAM,iBAAiB,aAAa,KAAK;AAG1D,UAAI,QAAQ;AACZ,iBAAW,QAAQ,OAAO;AACxB,cAAM,UAAU,SAAS,KAAK,CAAC,MAAM,EAAE,cAAc,KAAK,SAAS;AACnE,YAAI,CAAC,QAAS,OAAM,IAAI,MAAM,WAAW,KAAK,SAAS,YAAY;AAEnE,YAAI;AACJ,YAAI,KAAK,cAAc,KAAK;AAC1B,gBAAM,UAAU,QAAQ,SAAS;AAAA,YAC/B,CAAC,MAAM,EAAE,cAAc,KAAK;AAAA,UAC9B;AACA,cAAI,CAAC,QAAS,OAAM,IAAI,MAAM,WAAW,KAAK,SAAS,0BAA0B,KAAK,SAAS,EAAE;AACjG,kBAAQ,OAAO,QAAQ,KAAK;AAAA,QAC9B,OAAO;AACL,kBAAQ,OAAO,QAAQ,KAAK;AAAA,QAC9B;AACA,iBAAS,QAAQ,OAAO,KAAK,QAAQ;AAAA,MACvC;AAEA,YAAM,aAAa,MAAM,IAAI,CAAC,OAAO;AAAA,QACnC,WAAW,OAAO,EAAE,SAAS;AAAA,QAC7B,WAAW,OAAO,EAAE,SAAS;AAAA,QAC7B,UAAU,OAAO,EAAE,QAAQ;AAAA,MAC7B,EAAE;AAEF,YAAM,OAAO,MAAM,aAAa,cAAc;AAAA,QAC5C,SAAS;AAAA,QACT,KAAK;AAAA,QACL,cAAc;AAAA,QACd,MAAM,CAAC,UAAU;AAAA,QACjB,OAAO;AAAA,QACP;AAAA,QACA,OAAO,aAAa;AAAA,MACtB,CAAC;AAED,YAAM,UAAU,MAAM,aAAa,0BAA0B,EAAE,KAAK,CAAC;AAGrE,UAAI;AACJ,iBAAW,OAAO,QAAQ,MAAM;AAC9B,YAAI;AACF,gBAAM,QAAQ,eAAe;AAAA,YAC3B,KAAK;AAAA,YACL,MAAM,IAAI;AAAA,YACV,QAAQ,IAAI;AAAA,UACd,CAAC;AACD,cAAI,MAAM,cAAc,gBAAgB;AACtC,sBAAW,MAAM,KAA6B,QAAQ,SAAS;AAAA,UACjE;AAAA,QACF,QAAQ;AAAA,QAER;AAAA,MACF;AAEA,aAAO;AAAA,QACL,SAAS;AAAA,UACP;AAAA,YACE,MAAM;AAAA,YACN,MAAM,KAAK,UAAU;AAAA,cACnB,SAAS;AAAA,cACT,QAAQ;AAAA,cACR;AAAA,cACA,WAAW,YAAY,KAAK,IAAI;AAAA,cAChC,aAAa,QAAQ,YAAY,SAAS;AAAA,YAC5C,GAAG,MAAM,CAAC;AAAA,UACZ;AAAA,QACF;AAAA,MACF;AAAA,IACF;AAAA,EACF;AAEA,EAAAD,QAAO;AAAA,IACL;AAAA,IACA;AAAA,IACA;AAAA,MACE,aAAaC,GAAE,OAAO,EAAE,SAAS,uBAAuB;AAAA,MACxD,SAASA,GAAE,OAAO,EAAE,SAAS,oBAAoB;AAAA,IACnD;AAAA,IACA,OAAO,EAAE,aAAa,QAAQ,MAAM;AAClC,YAAM,eAAe,gBAAgB;AACrC,YAAM,eAAe,gBAAgB;AACrC,YAAM,UAAU,WAAW;AAE3B,YAAM,OAAO,MAAM,aAAa,cAAc;AAAA,QAC5C,SAAS;AAAA,QACT,KAAK;AAAA,QACL,cAAc;AAAA,QACd,MAAM,CAAC,OAAO,OAAO,CAAC;AAAA,QACtB;AAAA,QACA,OAAO,aAAa;AAAA,MACtB,CAAC;AAED,YAAM,UAAU,MAAM,aAAa,0BAA0B,EAAE,KAAK,CAAC;AAErE,aAAO;AAAA,QACL,SAAS;AAAA,UACP;AAAA,YACE,MAAM;AAAA,YACN,MAAM,KAAK,UAAU;AAAA,cACnB,SAAS;AAAA,cACT,QAAQ;AAAA,cACR;AAAA,cACA,aAAa,QAAQ,YAAY,SAAS;AAAA,YAC5C,GAAG,MAAM,CAAC;AAAA,UACZ;AAAA,QACF;AAAA,MACF;AAAA,IACF;AAAA,EACF;AAEA,EAAAD,QAAO;AAAA,IACL;AAAA,IACA;AAAA,IACA;AAAA,MACE,aAAaC,GAAE,OAAO,EAAE,SAAS,uBAAuB;AAAA,MACxD,SAASA,GAAE,OAAO,EAAE,SAAS,oBAAoB;AAAA,MACjD,QAAQA,GAAE,OAAO,EAAE,IAAI,EAAE,IAAI,CAAC,EAAE,IAAI,CAAC,EAAE,SAAS,oBAAoB;AAAA,MACpE,MAAMA,GAAE,OAAO,EAAE,SAAS,qCAAqC;AAAA,IACjE;AAAA,IACA,OAAO,EAAE,aAAa,SAAS,QAAQ,KAAK,MAAM;AAChD,YAAM,eAAe,gBAAgB;AACrC,YAAM,eAAe,gBAAgB;AACrC,YAAM,UAAU,WAAW;AAE3B,YAAM,OAAO,MAAM,aAAa,cAAc;AAAA,QAC5C,SAAS;AAAA,QACT,KAAK;AAAA,QACL,cAAc;AAAA,QACd,MAAM,CAAC,OAAO,OAAO,GAAG,QAAQ,IAAI;AAAA,QACpC;AAAA,QACA,OAAO,aAAa;AAAA,MACtB,CAAC;AAED,YAAM,UAAU,MAAM,aAAa,0BAA0B,EAAE,KAAK,CAAC;AAErE,UAAI;AACJ,iBAAW,OAAO,QAAQ,MAAM;AAC9B,YAAI;AACF,gBAAM,QAAQ,eAAe;AAAA,YAC3B,KAAK;AAAA,YACL,MAAM,IAAI;AAAA,YACV,QAAQ,IAAI;AAAA,UACd,CAAC;AACD,cAAI,MAAM,cAAc,iBAAiB;AACvC,uBAAY,MAAM,KAA8B,SAAS,SAAS;AAAA,UACpE;AAAA,QACF,QAAQ;AAAA,QAER;AAAA,MACF;AAEA,aAAO;AAAA,QACL,SAAS;AAAA,UACP;AAAA,YACE,MAAM;AAAA,YACN,MAAM,KAAK,UAAU;AAAA,cACnB,SAAS;AAAA,cACT,QAAQ;AAAA,cACR;AAAA,cACA,aAAa,QAAQ,YAAY,SAAS;AAAA,YAC5C,GAAG,MAAM,CAAC;AAAA,UACZ;AAAA,QACF;AAAA,MACF;AAAA,IACF;AAAA,EACF;AACF;;;AGpMA,SAAS,KAAAC,UAAS;AAClB,SAAS,kBAAAC,iBAAgB,cAAAC,aAAY,mBAA2B;;;ACFzD,IAAM,iBAAiB;AAAA,EAC5B;AAAA,IACE,MAAM;AAAA,IACN,MAAM;AAAA,IACN,QAAQ;AAAA,MACN,EAAE,MAAM,QAAQ,MAAM,SAAS;AAAA,MAC/B,EAAE,MAAM,eAAe,MAAM,SAAS;AAAA,IACxC;AAAA,IACA,SAAS,CAAC,EAAE,MAAM,QAAQ,MAAM,UAAU,CAAC;AAAA,IAC3C,iBAAiB;AAAA,EACnB;AAAA,EACA;AAAA,IACE,MAAM;AAAA,IACN,MAAM;AAAA,IACN,QAAQ,CAAC;AAAA,IACT,SAAS,CAAC,EAAE,MAAM,IAAI,MAAM,YAAY,CAAC;AAAA,IACzC,iBAAiB;AAAA,EACnB;AAAA,EACA;AAAA,IACE,MAAM;AAAA,IACN,MAAM;AAAA,IACN,QAAQ,CAAC,EAAE,MAAM,IAAI,MAAM,UAAU,CAAC;AAAA,IACtC,SAAS,CAAC,EAAE,MAAM,IAAI,MAAM,OAAO,CAAC;AAAA,IACpC,iBAAiB;AAAA,EACnB;AAAA,EACA;AAAA,IACE,MAAM;AAAA,IACN,MAAM;AAAA,IACN,QAAQ,CAAC;AAAA,IACT,SAAS,CAAC,EAAE,MAAM,IAAI,MAAM,UAAU,CAAC;AAAA,IACvC,iBAAiB;AAAA,EACnB;AAAA,EACA;AAAA,IACE,MAAM;AAAA,IACN,MAAM;AAAA,IACN,QAAQ,CAAC;AAAA,IACT,SAAS,CAAC,EAAE,MAAM,IAAI,MAAM,UAAU,CAAC;AAAA,IACvC,iBAAiB;AAAA,EACnB;AAAA,EACA;AAAA,IACE,MAAM;AAAA,IACN,MAAM;AAAA,IACN,QAAQ;AAAA,MACN,EAAE,MAAM,QAAQ,MAAM,WAAW,SAAS,KAAK;AAAA,MAC/C,EAAE,MAAM,SAAS,MAAM,WAAW,SAAS,KAAK;AAAA,MAChD,EAAE,MAAM,QAAQ,MAAM,UAAU,SAAS,MAAM;AAAA,IACjD;AAAA,IACA,WAAW;AAAA,EACb;AACF;;;ADzCO,SAAS,mBAAmBC,SAAmB;AACpD,EAAAA,QAAO;AAAA,IACL;AAAA,IACA;AAAA,IACA;AAAA,MACE,MAAMC,GAAE,OAAO,EAAE,SAAS,WAAW;AAAA,MACrC,aAAaA,GAAE,OAAO,EAAE,SAAS,2BAA2B;AAAA,IAC9D;AAAA,IACA,OAAO,EAAE,MAAM,YAAY,MAAM;AAC/B,YAAM,eAAe,gBAAgB;AACrC,YAAM,eAAe,gBAAgB;AACrC,YAAM,UAAU,WAAW;AAC3B,YAAM,EAAE,WAAW,IAAI,UAAU;AAEjC,YAAM,OAAO,MAAM,aAAa,cAAc;AAAA,QAC5C,SAAS;AAAA,QACT,KAAK;AAAA,QACL,cAAc;AAAA,QACd,MAAM,CAAC,MAAM,WAAW;AAAA,QACxB;AAAA,QACA,OAAO,aAAa;AAAA,MACtB,CAAC;AAED,YAAM,UAAU,MAAM,aAAa,0BAA0B,EAAE,KAAK,CAAC;AAErE,UAAI;AACJ,iBAAW,OAAO,QAAQ,MAAM;AAC9B,YAAI;AACF,gBAAM,QAAQC,gBAAe;AAAA,YAC3B,KAAK;AAAA,YACL,MAAM,IAAI;AAAA,YACV,QAAQ,IAAI;AAAA,UACd,CAAC;AACD,cAAI,MAAM,cAAc,eAAe;AACrC,0BAAe,MAAM,KAA0B;AAAA,UACjD;AAAA,QACF,QAAQ;AAAA,QAER;AAAA,MACF;AAEA,aAAO;AAAA,QACL,SAAS,CAAC;AAAA,UACR,MAAM;AAAA,UACN,MAAM,KAAK,UAAU,EAAE,SAAS,MAAM,QAAQ,MAAM,aAAa,aAAa,QAAQ,YAAY,SAAS,EAAE,GAAG,MAAM,CAAC;AAAA,QACzH,CAAC;AAAA,MACH;AAAA,IACF;AAAA,EACF;AAEA,EAAAF,QAAO;AAAA,IACL;AAAA,IACA;AAAA,IACA;AAAA,MACE,aAAaC,GAAE,OAAO,EAAE,SAAS,uBAAuB;AAAA,MACxD,MAAMA,GAAE,OAAO,EAAE,SAAS,cAAc;AAAA,MACxC,UAAUA,GAAE,OAAO,EAAE,SAAS,4BAA4B;AAAA,MAC1D,OAAOA,GAAE,OAAO,EAAE,IAAI,EAAE,YAAY,EAAE,SAAS,eAAe;AAAA,MAC9D,YAAYA,GAAE,OAAO,EAAE,QAAQ,GAAG,EAAE,SAAS,mCAAmC;AAAA,MAChF,aAAaA,GAAE,OAAO,EAAE,QAAQ,EAAE,EAAE,SAAS,cAAc;AAAA,IAC7D;AAAA,IACA,OAAO,EAAE,aAAa,MAAM,UAAU,OAAO,YAAY,YAAY,MAAM;AACzE,YAAM,eAAe,gBAAgB;AACrC,YAAM,eAAe,gBAAgB;AACrC,YAAM,UAAU,WAAW;AAE3B,YAAM,OAAO,MAAM,aAAa,cAAc;AAAA,QAC5C,SAAS;AAAA,QACT,KAAK;AAAA,QACL,cAAc;AAAA,QACd,MAAM,CAAC,MAAME,YAAW,QAAQ,GAAG,OAAO,KAAK,GAAG,OAAO,UAAU,GAAG,WAAW;AAAA,QACjF;AAAA,QACA,OAAO,aAAa;AAAA,MACtB,CAAC;AAED,YAAM,UAAU,MAAM,aAAa,0BAA0B,EAAE,KAAK,CAAC;AAErE,UAAI;AACJ,iBAAW,OAAO,QAAQ,MAAM;AAC9B,YAAI;AACF,gBAAM,QAAQD,gBAAe,EAAE,KAAK,SAAS,MAAM,IAAI,MAAM,QAAQ,IAAI,OAAO,CAAC;AACjF,cAAI,MAAM,cAAc,kBAAkB;AACxC,wBAAa,MAAM,KAA+B,UAAU,SAAS;AAAA,UACvE;AAAA,QACF,QAAQ;AAAA,QAAC;AAAA,MACX;AAEA,aAAO;AAAA,QACL,SAAS,CAAC;AAAA,UACR,MAAM;AAAA,UACN,MAAM,KAAK,UAAU,EAAE,SAAS,MAAM,QAAQ,MAAM,WAAW,aAAa,QAAQ,YAAY,SAAS,EAAE,GAAG,MAAM,CAAC;AAAA,QACvH,CAAC;AAAA,MACH;AAAA,IACF;AAAA,EACF;AAEA,EAAAF,QAAO;AAAA,IACL;AAAA,IACA;AAAA,IACA;AAAA,MACE,aAAaC,GAAE,OAAO,EAAE,SAAS,uBAAuB;AAAA,MACxD,MAAMA,GAAE,OAAO,EAAE,SAAS,eAAe;AAAA,MACzC,aAAaA,GAAE,OAAO,EAAE,QAAQ,EAAE,EAAE,SAAS,cAAc;AAAA,IAC7D;AAAA,IACA,OAAO,EAAE,aAAa,MAAM,YAAY,MAAM;AAC5C,YAAM,eAAe,gBAAgB;AACrC,YAAM,eAAe,gBAAgB;AACrC,YAAM,UAAU,WAAW;AAE3B,YAAM,OAAO,MAAM,aAAa,cAAc;AAAA,QAC5C,SAAS;AAAA,QACT,KAAK;AAAA,QACL,cAAc;AAAA,QACd,MAAM,CAAC,MAAM,WAAW;AAAA,QACxB;AAAA,QACA,OAAO,aAAa;AAAA,MACtB,CAAC;AAED,YAAM,UAAU,MAAM,aAAa,0BAA0B,EAAE,KAAK,CAAC;AAErE,UAAI;AACJ,iBAAW,OAAO,QAAQ,MAAM;AAC9B,YAAI;AACF,gBAAM,QAAQC,gBAAe,EAAE,KAAK,SAAS,MAAM,IAAI,MAAM,QAAQ,IAAI,OAAO,CAAC;AACjF,cAAI,MAAM,cAAc,mBAAmB;AACzC,yBAAc,MAAM,KAAgC,WAAW,SAAS;AAAA,UAC1E;AAAA,QACF,QAAQ;AAAA,QAAC;AAAA,MACX;AAEA,aAAO;AAAA,QACL,SAAS,CAAC;AAAA,UACR,MAAM;AAAA,UACN,MAAM,KAAK,UAAU,EAAE,SAAS,MAAM,QAAQ,MAAM,YAAY,aAAa,QAAQ,YAAY,SAAS,EAAE,GAAG,MAAM,CAAC;AAAA,QACxH,CAAC;AAAA,MACH;AAAA,IACF;AAAA,EACF;AAEA,EAAAF,QAAO;AAAA,IACL;AAAA,IACA;AAAA,IACA;AAAA,MACE,aAAaC,GAAE,OAAO,EAAE,SAAS,uBAAuB;AAAA,MACxD,SAASA,GAAE,OAAO,EAAE,SAAS,qBAAqB;AAAA,IACpD;AAAA,IACA,OAAO,EAAE,aAAa,QAAQ,MAAM;AAClC,YAAM,eAAe,gBAAgB;AACrC,YAAM,eAAe,gBAAgB;AACrC,YAAM,UAAU,WAAW;AAE3B,YAAM,OAAO,MAAM,aAAa,cAAc;AAAA,QAC5C,SAAS;AAAA,QACT,KAAK;AAAA,QACL,cAAc;AAAA,QACd,MAAM,CAAC,OAAO,OAAO,CAAC;AAAA,QACtB;AAAA,QACA,OAAO,aAAa;AAAA,MACtB,CAAC;AAED,YAAM,UAAU,MAAM,aAAa,0BAA0B,EAAE,KAAK,CAAC;AAErE,aAAO;AAAA,QACL,SAAS,CAAC;AAAA,UACR,MAAM;AAAA,UACN,MAAM,KAAK,UAAU,EAAE,SAAS,MAAM,QAAQ,MAAM,SAAS,aAAa,QAAQ,YAAY,SAAS,EAAE,GAAG,MAAM,CAAC;AAAA,QACrH,CAAC;AAAA,MACH;AAAA,IACF;AAAA,EACF;AAEA,EAAAD,QAAO;AAAA,IACL;AAAA,IACA;AAAA,IACA;AAAA,MACE,aAAaC,GAAE,OAAO,EAAE,SAAS,uBAAuB;AAAA,MACxD,MAAMA,GAAE,OAAO,EAAE,SAAS,sBAAsB;AAAA,MAChD,aAAaA,GAAE,OAAO,EAAE,IAAI,EAAE,IAAI,CAAC,EAAE,IAAI,GAAK,EAAE,SAAS,qCAAqC;AAAA,MAC9F,SAASA,GAAE,OAAO,EAAE,IAAI,EAAE,SAAS,EAAE,SAAS,wBAAwB;AAAA,MACtE,WAAWA,GAAE,OAAO,EAAE,IAAI,EAAE,SAAS,kDAAkD;AAAA,IACzF;AAAA,IACA,OAAO,EAAE,aAAa,MAAM,aAAa,SAAS,UAAU,MAAM;AAChE,YAAM,eAAe,gBAAgB;AACrC,YAAM,eAAe,gBAAgB;AACrC,YAAM,UAAU,WAAW;AAG3B,YAAM,UAAU,YAAY,MAAM,EAAE,MAAM,GAAG,CAAC;AAE9C,YAAM,OAAO,MAAM,aAAa,cAAc;AAAA,QAC5C,SAAS;AAAA,QACT,KAAK;AAAA,QACL,cAAc;AAAA,QACd,MAAM,CAAC,SAAS,OAAO,WAAW,GAAG,OAAO,OAAO,GAAG,OAAO,SAAS,CAAC;AAAA,QACvE;AAAA,QACA,OAAO,aAAa;AAAA,MACtB,CAAC;AAED,YAAM,UAAU,MAAM,aAAa,0BAA0B,EAAE,KAAK,CAAC;AAErE,UAAI;AACJ,iBAAW,OAAO,QAAQ,MAAM;AAC9B,YAAI;AACF,gBAAM,QAAQC,gBAAe,EAAE,KAAK,SAAS,MAAM,IAAI,MAAM,QAAQ,IAAI,OAAO,CAAC;AACjF,cAAI,MAAM,cAAc,mBAAmB;AACzC,yBAAc,MAAM,KAAgC,WAAW,SAAS;AAAA,UAC1E;AAAA,QACF,QAAQ;AAAA,QAAC;AAAA,MACX;AAEA,aAAO;AAAA,QACL,SAAS,CAAC;AAAA,UACR,MAAM;AAAA,UACN,MAAM,KAAK,UAAU,EAAE,SAAS,MAAM,QAAQ,MAAM,YAAY,MAAM,aAAa,QAAQ,YAAY,SAAS,EAAE,GAAG,MAAM,CAAC;AAAA,QAC9H,CAAC;AAAA,MACH;AAAA,IACF;AAAA,EACF;AACF;;;AP5NA,IAAM,SAAS,IAAI,UAAU;AAAA,EAC3B,MAAM;AAAA,EACN,SAAS;AACX,CAAC;AAGD,kBAAkB,MAAM;AACxB,mBAAmB,MAAM;AACzB,mBAAmB,MAAM;AAGzB,IAAM,YAAY,IAAI,qBAAqB;AAC3C,MAAM,OAAO,QAAQ,SAAS;","names":["server","query","z","server","z","z","decodeEventLog","parseEther","server","z","decodeEventLog","parseEther"]}